#!/bin/bash
# OpenWrt Configuration File - Fixed Version
# Device: Hiveton H5000M (MediaTek MT7981/MT7986/MT7992)

# ============================================
# 1. 基础系统配置
# ============================================

CONFIG_MODULES=y
CONFIG_HAVE_DOT_CONFIG=y
CONFIG_HOST_OS_LINUX=y

# 目标平台
CONFIG_TARGET_mediatek=y
CONFIG_TARGET_mediatek_filogic=y
CONFIG_TARGET_mediatek_filogic_DEVICE_hiveton-h5000m=y
CONFIG_TARGET_BOARD="mediatek"
CONFIG_TARGET_SUBTARGET="filogic"
CONFIG_TARGET_PROFILE="DEVICE_hiveton-h5000m"
CONFIG_TARGET_ARCH_PACKAGES="aarch64_cortex-a53"

# CPU架构
CONFIG_aarch64=y
CONFIG_ARCH="aarch64"
CONFIG_CPU_TYPE="cortex-a53"
CONFIG_DEFAULT_TARGET_OPTIMIZATION="-Os -pipe -mcpu=cortex-a53"

# 内核版本
CONFIG_LINUX_6_6=y

# ============================================
# 2. 基础软件包
# ============================================

CONFIG_PACKAGE_base-files=y
CONFIG_PACKAGE_busybox=y
CONFIG_PACKAGE_ca-bundle=y
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_PACKAGE_dnsmasq_full_dhcp=y
CONFIG_PACKAGE_dnsmasq_full_dhcpv6=y
CONFIG_PACKAGE_dropbear=y
CONFIG_PACKAGE_firewall4=y
CONFIG_PACKAGE_fstools=y
CONFIG_PACKAGE_logd=y
CONFIG_PACKAGE_netifd=y
CONFIG_PACKAGE_opkg=y
CONFIG_PACKAGE_procd=y
CONFIG_PACKAGE_ubus=y
CONFIG_PACKAGE_ubusd=y
CONFIG_PACKAGE_uci=y
CONFIG_PACKAGE_uhttpd=y
CONFIG_PACKAGE_uhttpd-mod-ubus=y

# ============================================
# 3. 网络基础组件
# ============================================

CONFIG_PACKAGE_kmod-tun=y
CONFIG_PACKAGE_kmod-nft-tproxy=y
CONFIG_PACKAGE_kmod-macvlan=y
CONFIG_PACKAGE_kmod-ppp=y
CONFIG_PACKAGE_kmod-mppe=y
CONFIG_PACKAGE_kmod-pppoe=y
CONFIG_PACKAGE_ppp=y
CONFIG_PACKAGE_ppp-mod-pppoe=y
CONFIG_PACKAGE_odhcp6c=y
CONFIG_PACKAGE_odhcpd-ipv6only=y
CONFIG_PACKAGE_ethtool=y
CONFIG_PACKAGE_iw=y
CONFIG_PACKAGE_iwinfo=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_ip-full=y

# ============================================
# 4. 无线网络 (MTK WiFi 7)
# ============================================

CONFIG_PACKAGE_kmod-mt_hwifi=y
CONFIG_PACKAGE_kmod-mt_wifi7=y
CONFIG_PACKAGE_kmod-mt7992=y
CONFIG_PACKAGE_kmod-mt799a=y
CONFIG_PACKAGE_kmod-warp=y
CONFIG_PACKAGE_mtwifi-cfg=y
CONFIG_PACKAGE_wireless-regdb=y

# WiFi基础配置
CONFIG_MTK_WIFI7_CHIP_MT7992=y
CONFIG_MTK_WIFI7_FIRST_IF_MT7992=y
CONFIG_MTK_WIFI7_SECOND_IF_MT7992=y
CONFIG_MTK_WIFI7_APCLI_SUPPORT=y

# ============================================
# 5. USB和调制解调器支持（关键修复）
# ============================================

# USB基础驱动
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb2=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_kmod-usb-net=y
CONFIG_PACKAGE_kmod-usb-net-cdc-ether=y
CONFIG_PACKAGE_kmod-usb-net-cdc-mbim=y
CONFIG_PACKAGE_kmod-usb-net-cdc-ncm=y
CONFIG_PACKAGE_kmod-usb-net-qmi-wwan=y
CONFIG_PACKAGE_kmod-usb-serial=y
CONFIG_PACKAGE_kmod-usb-serial-option=y
CONFIG_PACKAGE_kmod-usb-serial-qualcomm=y

# QMI/MBIM库
CONFIG_PACKAGE_libqmi=y
CONFIG_LIBQMI_WITH_MBIM_QMUX=y
CONFIG_LIBQMI_COLLECTION_BASIC=y
CONFIG_PACKAGE_libmbim=y

# ============================================
# 6. QModem配置（解决冲突的关键）
# ============================================

CONFIG_PACKAGE_qmodem=y
CONFIG_PACKAGE_ubus-at-daemon=y
CONFIG_PACKAGE_luci-app-qmodem=y
CONFIG_PACKAGE_luci-app-qmodem-mwan=y

# 关键修复：禁用冲突的mtk/5g-modem包，使用qmodem feed版本
# CONFIG_PACKAGE_fibocom_QMI_WWAN is not set
# CONFIG_PACKAGE_quectel_QMI_WWAN is not set
# CONFIG_PACKAGE_simcom_QMI_WWAN is not set

# 使用qmodem feed的驱动
CONFIG_PACKAGE_kmod-qmi_wwan_f=y
CONFIG_PACKAGE_kmod-qmi_wwan_q=y
CONFIG_PACKAGE_kmod-qmi_wwan_s=y

# Quectel CM工具
CONFIG_PACKAGE_luci-app-qmodem_USE_TOM_CUSTOMIZED_QUECTEL_CM=y
CONFIG_PACKAGE_quectel-CM-5G-M=y

# IPv6支持
CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_ndisc6=y
CONFIG_PACKAGE_ndisc6=y

# ============================================
# 7. LuCI Web界面
# ============================================

CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-compat=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-mod-network=y
CONFIG_PACKAGE_luci-mod-system=y
CONFIG_PACKAGE_luci-theme-bootstrap=y
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y

# 中文支持
CONFIG_LUCI_LANG_zh_Hans=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y

# LuCI应用
CONFIG_PACKAGE_luci-app-firewall=y
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-app-adguardhome=y
CONFIG_PACKAGE_luci-app-mtwifi-cfg=y
CONFIG_PACKAGE_luci-app-Airpifanctrl=y
CONFIG_PACKAGE_luci-app-turboacc-mtk=y
CONFIG_PACKAGE_luci-app-eqos-mtk=y
CONFIG_PACKAGE_luci-app-upnp=y

# ============================================
# 8. 存储和文件系统
# ============================================

CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-exfat=y
CONFIG_PACKAGE_kmod-fs-ntfs3=y
CONFIG_PACKAGE_blkid=y
CONFIG_PACKAGE_e2fsprogs=y

# ============================================
# 9. 第三方增强包
# ============================================

CONFIG_PACKAGE_adguardhome=y
CONFIG_PACKAGE_smartdns=y
CONFIG_PACKAGE_nikki=y
CONFIG_PACKAGE_luci-app-nikki=y
CONFIG_PACKAGE_mihomo=y
CONFIG_PACKAGE_luci-app-mihomo=y

# ============================================
# 10. 防火墙和网络过滤
# ============================================

CONFIG_PACKAGE_firewall4=y
CONFIG_PACKAGE_nftables-json=y
CONFIG_PACKAGE_kmod-nft-core=y
CONFIG_PACKAGE_kmod-nft-fib=y
CONFIG_PACKAGE_kmod-nft-nat=y
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-nat=y

# ============================================
# 11. 核心库文件
# ============================================

CONFIG_PACKAGE_zlib=y
CONFIG_PACKAGE_libopenssl=y
CONFIG_PACKAGE_libjson-c=y
CONFIG_PACKAGE_libubox=y
CONFIG_PACKAGE_libubus=y
CONFIG_PACKAGE_libuci=y
CONFIG_PACKAGE_libuclient=y

# ============================================
# 12. 编译选项
# ============================================

CONFIG_CCACHE=y
CONFIG_DEVEL=y
CONFIG_BUILD_LOG=y

# 安全选项
CONFIG_PKG_CHECK_FORMAT_SECURITY=y
CONFIG_PKG_ASLR_PIE_REGULAR=y
CONFIG_PKG_CC_STACKPROTECTOR_REGULAR=y

# 根文件系统
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_ROOTFS_PARTSIZE=160
CONFIG_TARGET_SQUASHFS_BLOCK_SIZE=256

# IPv6支持
CONFIG_IPV6=y

# ============================================
# 13. 禁用的功能（避免冲突）
# ============================================

# 禁用iptables（使用firewall4）
# CONFIG_PACKAGE_iptables is not set
# CONFIG_PACKAGE_ip6tables is not set

# 禁用不必要的工具
# CONFIG_PACKAGE_luci-app-wrtbwmon is not set
# CONFIG_PACKAGE_luci-app-rclone is not set

# ============================================
# 结束配置
# ============================================